# Development Dockerfile for Open Source Project Generator

FROM golang:1.25-alpine

# Install development dependencies
RUN apk add --no-cache \
    git \
    ca-certificates \
    tzdata \
    make \
    bash \
    curl \
    wget \
    tar \
    gzip \
    && rm -rf /var/cache/apk/*

# Install development tools with compatible versions
RUN go install github.com/air-verse/air@latest && \
    go install gotest.tools/gotestsum@latest

# Create non-root user
RUN addgroup -g 1000 developer && \
    adduser -D -s /bin/bash -u 1000 -G developer developer

# Set working directory
WORKDIR /app

# Create necessary directories
RUN mkdir -p /workspace /home/developer/.config/generator /home/developer/.cache/generator /home/developer/go/pkg/mod /home/developer/.cache/go-build
RUN chown -R developer:developer /app /workspace /home/developer

# Switch to non-root user
USER developer

# Set environment variables
ENV GOOS=linux
ENV GOARCH=amd64
ENV CGO_ENABLED=0
ENV GENERATOR_LOG_LEVEL=debug
ENV GOPATH=/home/developer/go
ENV GOCACHE=/home/developer/.cache/go-build
ENV GOMODCACHE=/home/developer/go/pkg/mod

# Default command
CMD ["bash"]